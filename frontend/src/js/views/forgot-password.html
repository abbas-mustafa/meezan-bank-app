<div class="background">
  <img src="css/images/meezan-logo.png" alt="Meezan Bank Logo" class="bank-logo">

  <div class="forgot-box">

    <div class="steps" data-bind="visible: showStepperBar">
      <div class="step-item" data-bind="css: getStepClass(1)">
        <div class="step">1</div>
        <p>Account Type</p>
        <div class="step-line"></div>
      </div>
      <div class="step-item" data-bind="css: getStepClass(2)">
        <div class="step">2</div>
        <p>Account Details</p>
        <div class="step-line"></div>
      </div>
      <div class="step-item" data-bind="css: getStepClass(3)">
        <div class="step">3</div>
        <p>Verification</p>
        <div class="step-line"></div>
      </div>
      <div class="step-item" data-bind="css: getStepClass(4)">
        <div class="step">4</div>
        <p>Login Details</p>
      </div>
    </div>

    <div class="step-contents">

      <div class="step-content" data-bind="visible: isStepVisible(1)">
        <h2>Select Account Type</h2>
        <div class="account-types">
          <div class="account-card" data-bind="css: { active: isAccountSelected('Individual') }, click: function() { selectAccount('Individual'); }">
            <img data-bind="attr: { src: isAccountSelected('Individual') ? 'css/images/Individual-Icon-Filled.svg' : 'css/images/Individual-Icon-Unfilled.svg' }" alt="Individual" class="account-img">
            <p>Individual</p>
          </div>
          <!-- <div class="account-card" data-bind="css: { active: isAccountSelected('Sole Proprietor') }, click: function() { selectAccount('Sole Proprietor'); }">
            <img data-bind="attr: { src: isAccountSelected('Sole Proprietor') ? 'css/images/sole-after.png' : 'css/images/sole-before.png' }" alt="Sole Proprietor" class="account-img">
            <p>Sole Proprietor</p>
          </div> -->
          <div class="account-card" data-bind="css: { active: isAccountSelected('Foreign National') }, click: function() { selectAccount('Foreign National'); }">
            <img data-bind="attr: { src: isAccountSelected('Foreign National') ? 'css/images/Foreign-National-Icon-Filled.svg' : 'css/images/Foreign-National-Icon-Unfilled.svg' }" alt="Foreign National" class="account-img">
            <p>Foreign National</p>
          </div>
        </div>

        <div class="cnic-section" data-bind="visible: showCNICSection">
          <label for="cnic">CNIC NUMBER</label>
          <div class="input-box">
            <input type="text" id="cnic" placeholder="XXXXX-XXXXXXX-X" maxlength="15"
                   data-bind="
                       value: formattedCNIC,
                       valueUpdate: 'input',
                       event: {
                           keyup: function(data, event) {
                               if (event.keyCode === 13) {
                                   if ($data.isNextButtonEnabled()) {
                                       $data.nextStep();
                                   }
                               }
                           }
                       }
                   "
                   inputmode="numeric" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            <p class="cnic-help">Please enter your 13-digit CNIC number</p>
            <p class="validation-message" data-bind="text: cnicStatusMessage, style: { color: cnicStatusColor }, visible: cnicStatusMessage"></p>
          </div>

          <div class="cnic-info-box">
            <img src="css/images/nic.svg" alt="CNIC" class="cnic-img">
            <p class="cnic-title">Find your CNIC Identity Number</p>
            <p class="cnic-desc">
              Permanent citizens of Pakistan can find their CNIC identity numbers on their identity cards issued by NADRA
            </p>
          </div>
        </div>
      </div>

      <div class="step-content" data-bind="visible: isStepVisible(2)">
        <h2>Account Details</h2>
        <div class="account-details-types">
          <div class="detail-card" data-bind="css: { active: isDetailSelected('account-number') }, click: function() { selectDetailOption('account-number'); }">Account Number</div>
          <div class="detail-card" data-bind="css: { active: isDetailSelected('iban') }, click: function() { selectDetailOption('iban'); }">IBAN</div>
        </div>

        <div class="account-number-section" data-bind="visible: showAccountNumberSection">
          <label for="account-number">Account Number</label>
          <div class="input-box">
            <input type="text" id="account-number" placeholder="XXXXX-XXXXXXXXX" maxlength="15"
                   data-bind="
                       value: formattedAccountNumber, 
                       valueUpdate: 'input', 
                       event: {
                           keyup: function(data, event) {
                               if (event.keyCode === 13) {
                                   if ($data.isNextButtonEnabled()) {
                                       $data.nextStep();
                                   }
                               }
                           }
                       }
                   "
                   inputmode="numeric" onkeypress="return event.charCode >= 48 && event.charCode <= 57">
            <p class="cnic-help">Please enter your 14-digit Account Number</p>
            <p class="validation-message" data-bind="text: accountNumberStatusMessage, style: { color: accountNumberStatusColor }, visible: accountNumberStatusMessage"></p>
          </div>

          <div class="account-info-box">
            <img src="css/images/cheque.png" alt="Account" class="cheque-img">
            <p class="account-title">Find your Account Number</p>
            <p class="account-desc">You can find your account number on your chequebook or account statement</p>
          </div>
        </div>
      </div>

      <div class="step-content" data-bind="visible: isStepVisible(3)">
        <h2>Verification</h2>
        <p>Verification step - will be skipped in normal flow</p>
      </div>

      <div class="step-content" data-bind="visible: isStepVisible(4) && !showResetSection() && !showSuccessSection()">
        <h2>Username</h2>
        <div class="username-section">
          <div class="username-box" data-bind="text: username"></div>
        </div>
        <div class="step-buttons">
          <button class="btn continue-login" data-bind="click: continueToLogin">Continue to Login</button>
          <button class="btn reset-password" data-bind="click: showResetPassword">Reset Password</button>
        </div>
        <p class="helper-text">
          In case if you remember your Password, proceed to Login. <br>
          If you wish to reset your password click on <b>Reset Password</b>
        </p>
      </div>

      <form class="step-content" data-bind="visible: showResetSection, submit: updatePassword">
        <h2>Reset Password</h2>
        <input type="text" autocomplete="username" data-bind="value: username" style="display: none;">

        <h3>New Password</h3>
        <div class="password-wrapper">
          <input id="newPassword" placeholder="Enter New Password"
                 autocomplete="new-password"
                 data-bind="value: newPassword, valueUpdate: 'input', attr: { type: newPasswordType }">
          <span class="toggle-password" data-bind="text: newPasswordToggleText, click: toggleNewPassword"></span>
        </div>

        <div class="strength-bar" data-bind="foreach: strengthBars">
          <div data-bind="style: { backgroundColor: color }"></div>
        </div>
        <div class="strength-text">Password Strength: 
            <span data-bind="text: passwordStrengthText, style: { color: passwordStrengthColor }"></span>
        </div>

        <ul class="rules">
          <li>Password should be alphanumeric.</li>
          <li>Minimum password length should be 8.</li>
          <li>Special characters are optional.</li>
        </ul>

        <h3>Re-enter New Password</h3>
        <div class="password-wrapper">
          <input id="confirmPassword" placeholder="Re-enter New Password"
                 autocomplete="new-password"
                 data-bind="value: confirmPassword, valueUpdate: 'input', attr: { type: confirmPasswordType }">
          <span class="toggle-password" data-bind="text: confirmPasswordToggleText, click: toggleConfirmPassword"></span>
        </div>
        
        <div class="match-text" 
             data-bind="text: passwordMatchText, style: { color: passwordMatchColor }, visible: confirmPassword().length > 0">
        </div>

        <div class="btn-row">
          <button type="button" class="btn-back" data-bind="click: backToUsername">Back to Username</button>
          <button type="submit" class="btn-update" data-bind="enable: isUpdatePasswordEnabled, attr: { style: updatePasswordButtonStyle }">Update Password</button>
        </div>
      </form>

      <div class="buttons" data-bind="visible: showGlobalButtons">
        <button type="button" class="back" data-bind="click: backStep">Back</button>
        <button type="button" class="next" data-bind="click: nextStep, enable: isNextButtonEnabled, attr: { style: nextButtonStyle }">Next</button>
      </div>

      <div class="step-content" data-step="success" data-bind="visible: showSuccessSection">
        <h4>You have successfully 
          <br>changed your password
        </h4>
        <p> Following are the details of your registered online banking account.</p>
        <img src="css/images/checkmark.svg" alt="Checkmark" class="checkmark">
        <div class="account-details">
          <div class="detail">
            <span class="label">USERNAME</span>
            <span class="value" data-bind="text: username"></span>
          </div>
          <div class="detail">
            <span class="label">ACCOUNT NUMBER</span>
            <span class="value" data-bind="text: formattedAccountNumber"></span>
          </div>
        </div>
        <div class="success-actions">
          <button class="btn continue-login" data-bind="click: continueFromSuccess">Continue to Login</button>
        </div>
      </div>
    </div>
  </div>
</div>